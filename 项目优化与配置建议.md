# 项目优化与配置建议

## 一、项目文件体积优化建议

### 1. 依赖优化

**当前问题**: 项目依赖分析显示有一些优化空间

**优化建议**: 

```bash
# 移除冗余依赖（如果不使用）
npm uninstall flags

# 可以考虑的替代方案（如果图表功能使用有限）
npm uninstall chart.js
npm install lightweight-charts --save
```

### 2. 改进 Vite 构建配置

**当前问题**: 当前的 Vite 配置已经有基本优化，但可以进一步增强

**优化建议**: 在 vite.config.js 中添加以下配置：

```javascript
// 添加资源压缩插件
import { defineConfig } from 'vite'
import { ViteImageOptimizer } from 'vite-plugin-image-optimizer'
import { viteSingleFile } from 'vite-plugin-singlefile'

// 生产环境才启用某些优化插件
const plugins = []
if (process.env.NODE_ENV === 'production') {
  plugins.push(
    ViteImageOptimizer({
      png: { quality: 80 },
      jpeg: { quality: 80 },
      webp: { quality: 80 },
      svg: { multipass: true },
    }),
    // 可选：如果项目适合单文件部署
    // viteSingleFile()
  )
}

// 在原有的 defineConfig 中添加这些优化
```

### 3. 按需导入第三方库

**当前问题**: 一些大型第三方库可能被完整导入

**优化建议**: 

```javascript
// 示例：优化 Chart.js 的导入方式
import Chart from 'chart.js/auto'

// 或更精确地按需导入
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Title,
  Tooltip,
  Legend,
} from 'chart.js'

// 只注册需要的组件
ChartJS.register(
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Title,
  Tooltip,
  Legend
)
```

### 4. 代码分割优化

**当前问题**: 当前的代码分割逻辑较为简单

**优化建议**: 改进 manualChunks 逻辑，更精确地分割代码：

```javascript
manualChunks(id) {
  if (id.includes('node_modules')) {
    // 更精细地分割第三方依赖
    if (id.includes('chart.js')) {
      return 'vendor-chartjs'
    }
    if (id.includes('@flags-sdk/statsig')) {
      return 'vendor-statsig'
    }
    return 'vendors'
  }
  // 按功能模块分割项目代码
  if (id.includes('modules/charts')) {
    return 'app-charts'
  }
  if (id.includes('modules/auth')) {
    return 'app-auth'
  }
}
```

### 5. 静态资源优化

**当前问题**: 静态资源处理可以更高效

**优化建议**: 
- 将小图标转换为 SVG 或字体图标
- 考虑使用 WebP 格式图片
- 实现图片懒加载

## 二、GitHub 仓库配置优化

### 1. 完善 .gitignore 文件

**当前配置**: 基础忽略规则已存在

**优化建议**: 更新 .gitignore 文件，添加更多忽略规则：

```gitignore
# 操作系统文件
Thumbs.db
.DS_Store

# 构建输出
build/

# 测试覆盖率
.nyc_output/

# 编辑器相关文件
.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json
!.vscode/*.code-snippets

# 本地环境文件
.env.local
.env.development.local
.env.test.local
.env.production.local

# 临时文件
*.tmp
*.temp
.cache
.parcel-cache
.next
.nuxt
.vuepress/dist
.serverless/
.fusebox/
.dynamodb/

# 其他
*.tgz
.yarn-integrity
```

### 2. 添加 .npmrc 文件

**建议**: 创建 .npmrc 文件以确保依赖安装一致性：

```
# .npmrc
engine-strict=true
```

## 三、Vercel 部署配置优化

### 1. 更新 vercel.json 文件

**当前配置**: 基本部署配置已存在

**优化建议**: 更新 vercel.json 文件以优化部署和缓存：

```json
{
  "version": 2,
  "framework": "vite",
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "dist",
        "buildCommand": "npm run build",
        "installCommand": "npm ci",
        "staticFiles": {
          "staticOutputPath": "dist"
        }
      }
    }
  ],
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ],
  "redirects": [
    {
      "source": "/old-path",
      "destination": "/new-path",
      "permanent": true
    }
  ],
  "cleanUrls": true,
  "trailingSlash": false,
  "public": true,
  "headers": [
    {
      "source": "(.*\\.js|.*\\.css|.*\\.svg|.*\\.png|.*\\.jpg|.*\\.webp)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "max-age=31536000, immutable"
        }
      ]
    },
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Frame-Options",
          "value": "SAMEORIGIN"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        },
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        }
      ]
    }
  ],
  "env": {
    "NODE_ENV": "production"
  }
}
```

### 2. 环境变量配置

**建议**: 在 Vercel 控制台配置环境变量，而不是在代码仓库中存储敏感信息

### 3. 部署忽略配置

**当前问题**: 所有文件都可能被推送到 Vercel

**优化建议**: 在 package.json 中添加 "vercel-build" 脚本，自动清理不需要的文件：

```json
{
  "scripts": {
    "vercel-build": "npm run build && rm -rf node_modules .gitignore .vscode"
  }
}
```

## 四、实施步骤

1. 安装所需优化插件：
   ```bash
   npm install --save-dev vite-plugin-image-optimizer vite-plugin-singlefile
   ```

2. 更新 .gitignore 文件，添加更多忽略规则

3. 更新 vite.config.js，添加优化配置

4. 更新 vercel.json，完善部署配置

5. 实施代码分割和按需导入优化

6. 运行构建命令验证优化效果：
   ```bash
   npm run build
   ```

通过以上优化措施，预计可以显著减小项目文件体积，提高加载速度，并确保 GitHub 和 Vercel 配置的最佳实践。