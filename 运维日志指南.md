# 皓月量化智能引擎 网站运维日志指南

## 最近系统更新记录

### 2025年10月1日
- 集成Statsig功能标志管理系统：
  - 添加了环境变量配置（VITE_STATSIG_CLIENT_KEY、VITE_STATSIG_SERVER_API_KEY、VITE_EXPERIMENTATION_CONFIG_ITEM_KEY）
  - 实现了用户身份识别功能（identify函数）
  - 实现了功能标志管理功能（createFeatureFlag函数）
  - 集成到首页，在右上角显示功能标志状态
- 修复了主页无法加载的问题：
  - 原因：应用初始化完成后没有调用导航到首页的函数
  - 解决方案：在main.js的initApp函数末尾添加navigateTo('home')调用（延迟1秒执行以确保其他初始化完成）
- 移除了首页加载特效：
  - 修改内容：移除黑洞入口界面的HTML结构和相关JavaScript代码
  - 调整样式：移除body上的overflow-hidden样式，让页面可以正常滚动
  - 验证构建：确认构建成功，应用现在直接显示首页内容，不再显示加载动画和黑洞特效

### 2025年9月29日
- **前端技术栈更新**: 将Tailwind CSS从CDN方式迁移到本地PostCSS插件方式
  - 安装了@tailwindcss/postcss和相关依赖包
  - 创建了tailwind.config.js配置文件
  - 更新了postcss.config.js配置文件
  - 将内联的Tailwind配置和自定义工具类移动到单独的文件

- **构建配置优化**: 解决了Vite与PostCSS的兼容性问题
  - 在package.json中添加了"type": "module"
  - 修复了PostCSS插件配置的语法错误
  - 验证了构建流程，确保能成功生成dist目录

### 2025年9月28日
- 优化了构建配置，确保项目能够正常构建
- 验证了构建结果，确保dist目录正确生成

## 1. 运维日志的重要性

运维日志是网站运营和维护的重要组成部分，它能够：

- 记录系统运行状态和异常情况
- 帮助快速定位和排查问题
- 提供数据分析和性能优化的依据
- 满足安全审计和合规性要求
- 支持问题追溯和责任界定

## 2. 日志记录基本原则

### 2.1 完整性
- 记录所有关键操作、错误和异常
- 确保日志包含足够的上下文信息
- 保存足够长时间的历史日志

### 2.2 准确性
- 确保日志内容真实反映系统状态
- 避免日志信息的遗漏或篡改
- 记录精确的时间戳

### 2.3 一致性
- 统一的日志格式和标准
- 统一的日志级别定义
- 统一的日志存储和管理策略

### 2.4 安全性
- 保护日志数据的机密性和完整性
- 限制日志的访问权限
- 防范日志篡改和删除

## 3. 日志级别划分

| 级别 | 描述 | 使用场景 |
|------|------|---------|
| DEBUG | 调试信息 | 开发和测试环境，记录详细的系统运行信息 |
| INFO | 一般信息 | 记录正常的系统运行状态，如服务启动、配置加载等 |
| WARN | 警告信息 | 记录可能导致问题的情况，但不影响系统正常运行 |
| ERROR | 错误信息 | 记录系统错误，但不会导致系统崩溃或停止运行 |
| FATAL | 致命错误 | 记录导致系统崩溃或核心功能无法使用的严重错误 |
| AUDIT | 审计信息 | 记录重要的安全相关操作和访问记录 |

## 4. 日志格式规范

### 4.1 日志字段

每条日志应包含以下基本字段：

```
[时间戳] [日志级别] [来源] [模块] [用户] [操作/事件] [描述] [附加信息]
```

- **时间戳**: ISO 8601格式，包含时区信息，例如：2023-06-15T14:30:45+08:00
- **日志级别**: DEBUG/INFO/WARN/ERROR/FATAL/AUDIT
- **来源**: 产生日志的服务器IP或主机名
- **模块**: 产生日志的系统模块或组件
- **用户**: 执行操作的用户ID或用户名（如适用）
- **操作/事件**: 执行的操作或发生的事件名称
- **描述**: 事件的详细描述
- **附加信息**: 相关的请求ID、会话ID、错误码、堆栈信息等

### 4.2 示例格式

```
2023-06-15T14:30:45+08:00 INFO 192.168.1.100 webserver auth user_login User 'admin' logged in successfully {"session_id":"abc123","ip":"192.168.1.50"}
2023-06-15T14:35:12+08:00 ERROR 192.168.1.100 api-stock data_fetch Failed to fetch stock data {"symbol":"600000","error":"Connection timeout","request_id":"def456"}
2023-06-15T14:40:00+08:00 WARN 192.168.1.101 db-daily backup Database backup size exceeds threshold {"threshold":"10GB","current":"12.5GB"}
```

## 5. 日志存储与管理

### 5.1 日志存储方式

1. **文件日志**
   - 按日期和服务分类存储日志文件
   - 使用轮转策略管理日志文件大小和数量
   - 示例目录结构：`/var/log/haoyue/[service]/[year]/[month]/haoyue-[service]-[date].log`

2. **数据库日志**
   - 对于需要快速查询和分析的日志，可存储在关系型或NoSQL数据库中
   - 推荐使用专用的日志管理数据库如Elasticsearch

3. **集中式日志系统**
   - 考虑使用ELK Stack (Elasticsearch, Logstash, Kibana)进行日志的收集、存储和分析
   - 或使用其他商业日志管理平台

### 5.2 日志保留策略

- **短期日志 (1-7天)**: 存储在本地服务器，用于日常问题排查
- **中期日志 (1-3个月)**: 存储在集中式日志系统，用于趋势分析和问题追溯
- **长期日志 (1-5年)**: 归档存储，用于合规性要求和历史数据分析

### 5.3 日志备份与恢复

- 定期对重要日志进行备份
- 备份数据应存储在异地或云存储中
- 制定日志恢复计划和测试方案

## 6. 日志分析与监控

### 6.1 日志分析方法

- **实时监控**: 监控系统关键指标和错误率
- **趋势分析**: 分析日志中的趋势和模式
- **异常检测**: 识别日志中的异常情况和潜在问题
- **根因分析**: 分析问题的根本原因

### 6.2 监控告警

- 设置关键日志事件的告警规则
- 配置多级告警机制（邮件、短信、即时通讯等）
- 定义告警阈值和告警升级策略

### 6.3 日常检查内容

每天至少检查一次以下内容：

1. 系统错误日志
2. 安全相关日志
3. 服务可用性和性能日志
4. 数据库连接和查询日志
5. 磁盘空间和资源使用日志

## 7. 常见问题排查流程

### 7.1 一般性问题排查步骤

1. 确认问题现象和影响范围
2. 收集相关日志信息（时间、模块、错误码等）
3. 分析日志中的错误信息和上下文
4. 检查相关系统指标和配置
5. 尝试重现问题（如适用）
6. 提出解决方案并验证
7. 记录问题处理过程和结果

### 7.2 常见错误日志及处理方法

| 错误类型 | 可能原因 | 处理方法 |
|---------|---------|---------|
| 数据库连接失败 | 数据库服务不可用、连接参数错误、连接池满 | 检查数据库服务状态、验证连接参数、增加连接池大小 |
| API请求超时 | 网络问题、服务端响应慢、请求量大 | 检查网络连接、优化服务端性能、增加超时时间 |
| 内存溢出 | 内存泄漏、内存分配不足 | 分析内存使用情况、查找内存泄漏点、增加内存分配 |
| 文件权限错误 | 文件权限配置不当、文件不存在 | 检查文件权限、确认文件路径和存在性 |
| 安全访问拒绝 | 权限配置错误、IP限制、认证失败 | 检查用户权限、验证IP白名单、确认认证信息 |

## 8. 运维日志最佳实践

### 8.1 日志记录最佳实践

- 记录足够详细的信息，但避免日志过载
- 使用结构化日志格式，便于机器解析和分析
- 对敏感信息进行脱敏处理
- 为关键业务流程和操作创建唯一的跟踪ID
- 统一日志记录工具和框架的使用

### 8.2 日志管理最佳实践

- 实现日志的集中收集和管理
- 建立日志分级存储和保留策略
- 定期对日志系统进行维护和优化
- 为不同角色设置适当的日志访问权限
- 定期审计日志系统的安全性和完整性

### 8.3 日志分析最佳实践

- 结合监控系统进行日志分析
- 使用自动化工具进行日志分析和异常检测
- 定期生成日志分析报告
- 利用日志数据进行性能优化和容量规划
- 建立基于日志的业务分析机制

## 9. 紧急响应流程

### 9.1 严重事件响应

1. **识别阶段**: 发现系统异常或收到告警
2. **确认阶段**: 验证问题真实性和影响范围
3. **响应阶段**: 启动应急响应，通知相关人员
4. **处理阶段**: 根据问题类型执行相应的处理流程
5. **恢复阶段**: 确认系统恢复正常运行
6. **总结阶段**: 分析事件原因，记录经验教训，更新文档

### 9.2 关键联系人及联系方式

建立运维团队联系方式列表，并确保在紧急情况下能够及时联系到相关人员。

## 10. 文档更新与维护

- 定期更新本指南，确保其与实际运维需求保持一致
- 根据系统变更和新功能添加相应的日志记录要求
- 组织团队成员定期培训，确保所有人员理解并遵守日志规范
- 持续优化日志记录、存储和分析流程

---

**更新记录**

- 版本 1.0 (2023-06-15): 初始创建
- 2025-09-28: 系统优化与配置更新
  - 优化构建配置，确保项目能够正常构建
  - 验证构建结果正确生成index.html和main.js文件
  - 确保项目中无其他配置文件冲突